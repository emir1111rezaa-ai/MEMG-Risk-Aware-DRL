# Multi-Energy Microgrid with Risk-Aware Deep Reinforcement Learning

[![Python 3.8+](https://img.shields.io/badge/python-3.8+-blue.svg)](https://www.python.org/downloads/)
[![PyTorch](https://img.shields.io/badge/PyTorch-2.0+-red.svg)](https://pytorch.org/)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)

## ูพุฑูฺู ุชุญููุงุช: ูุฏุฑุช ุงูุฑฺ ุฑุฒุดุจฺฉู ฺูุฏุงูุฑฺ ุจุง ุงุฏฺฏุฑ ุชููุช ุนูู ุขฺฏุงู ุจู ุฑุณฺฉ

ุงู ูุฎุฒู ุดุงูู ูพุงุฏูโุณุงุฒ ฺฉุงูู ฺฉ ุณุณุชู ูุฏุฑุช ุงูุฑฺ (EMS) ุจุฑุง ุฑุฒุดุจฺฉูโูุง ฺูุฏุงูุฑฺ (MEMG) ุจุง ุงุณุชูุงุฏู ุงุฒ:

- **ูพุดโุจู ูพุดุฑูุชู**: ุดุจฺฉูโูุง CNN-LSTM ุจุง ูพุดโูพุฑุฏุงุฒุด Wavelet
- **DRL ุขฺฏุงู ุจู ุฑุณฺฉ**: ุงูฺฏูุฑุชู PPO ุจุง ูุฏู CVaR
- **ุณุณุชู ฺูุฏุงูุฑฺ**: ฺฉููพู ุจุฑู-ุญุฑุงุฑุช-ฺฏุงุฒ ุจุง PVุ WTุ ุจุงุชุฑุ CHP ู ุจููุฑ

---

## ๐ฏ ุงูุฏุงู ุชุญูู

### 1. ุทุฑุงุญ ุฑุฒุดุจฺฉู ฺูุฏุงูุฑฺ (MEMG)
- ุจุงุณ ุงูฺฉุชุฑฺฉ ุจุง ููุงุจุน PV ู ุชูุฑุจู ุจุงุฏ (WT)
- ุฐุฎุฑูโุณุงุฒ ุจุงุชุฑ ุจุง ูุฏูโุณุงุฒ ุฏูู ุฏูุงูฺฉ ุดุงุฑฺ/ุฏุดุงุฑฺ
- ูุงุญุฏ CHP (ุชููุฏ ููุฒูุงู ุจุฑู ู ุญุฑุงุฑุช)
- ุจููุฑ ฺฏุงุฒุณูุฒ ุจุฑุง ุชููุฏ ุญุฑุงุฑุช ุงุถุงู
- ุงุชุตุงู ุฏูุทุฑูู ุจู ุดุจฺฉู ุงุตู (ุฎุฑุฏ/ูุฑูุด)

### 2. ูุงฺูู ูพุดโุจู ูพุดุฑูุชู
- **ูพุดโูพุฑุฏุงุฒุด**: ุชุฌุฒู Wavelet (Daubechies db4) ุจุฑุง ุญุฐู ููุฒ
- **ูุนูุงุฑ**: CNN-LSTM ุจุง ูฺฉุงูุณู Attention
- **ุฎุฑูุฌ**: ูพุดโุจู 24 ุณุงุนุช ุขูุฏู + ุนุฏู ูุทุนุช (MC Dropout)
- **ูุชุบุฑูุง**: ุชููุฏ PV/WTุ ุจุงุฑ ุงูฺฉุชุฑฺฉุ ุจุงุฑ ุญุฑุงุฑุช

### 3. ุนุงูู DRL ุขฺฏุงู ุจู ุฑุณฺฉ
- **ุงูฺฏูุฑุชู**: Proximal Policy Optimization (PPO)
- **ูุถุง ุญุงูุช**: 10 ุจุนุฏ ุดุงูู SOCุ ูพุดโุจูโูุงุ ููุชุ ุฒูุงูุ ุนุฏู ูุทุนุช
- **ูุถุง ุนูู**: 4 ุจุนุฏ (ุชูุงู ุจุงุชุฑุ CHPุ ุดุจฺฉูุ ุจููุฑ)
- **ุชุงุจุน ูพุงุฏุงุด**: ุชุฑฺฉุจ ูุฒููุ CVaR (ุฑุณฺฉ)ุ ููุถ ููุฏุ ุณูุงูุช ุจุงุชุฑ

### 4. ููุงุณู ุจุง ุฑูุดโูุง ูุฑุฌุน
- **ุจูููโุณุงุฒ ฺฉูุงุณฺฉ**: MILP ุฏู ูุฑุญููโุง ุจุง ุณูุงุฑููุง ุชุตุงุฏู
- **DRL ุณุงุฏู**: ุจุฏูู ูพุดโุจู ูพุดุฑูุชู ู ุจุฏูู ูุงู ุฑุณฺฉ
- **ุฑูุด ูพุดููุงุฏ**: PPO + Forecasting + CVaR

---

## ๐ ูุชุงุฌ ููุฑุฏ ุงูุชุธุงุฑ

### ุจูุจูุฏูุง ฺฉูุฏ
1. โ **ฺฉุงูุด ูุฒูู ูุชูุณุท**: 15-25% ูุณุจุช ุจู ุฑูุด ฺฉูุงุณฺฉ
2. โ **ฺฉุงูุด ุฑุณฺฉ (CVaR)**: 20-30% ฺฉุงูุด ูุฒููโูุง ุฏู ุชูุฒุน
3. โ **ุงุณุชูุงุฏู ุจููู ุงุฒ ุจุงุชุฑ**: ฺฉุงูุด ูุฑุฎ ุชุบุฑุงุช ู ุงูุฒุงุด ุนูุฑ
4. โ **ฺฉุงูุด ููุถ ููุฏ**: 40-60% ฺฉูุชุฑ ุงุฒ ุฑูุดโูุง ูุฑุฌุน
5. โ **ุงูุฒุงุด ุจูุฑูโุจุฑุฏุงุฑ ุงุฒ ุชุฌุฏุฏูพุฐุฑูุง**: ุงุณุชูุงุฏู ุจูุชุฑ ุงุฒ PV/WT

---

## ๐๏ธ ูุนูุงุฑ ุณุณุชู

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                   MEMG SYSTEM ARCHITECTURE                  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โโโโโโโโโโโโโโโโโโโโ
โ  Data Generator  โ  โ Generate synthetic time-series
โโโโโโโโโโฌโโโโโโโโโโ
         โ
         โผ
โโโโโโโโโโโโโโโโโโโโ
โ   Forecasting    โ  โ Wavelet + CNN-LSTM
โ     Module       โ  โ MC Dropout for uncertainty
โโโโโโโโโโฌโโโโโโโโโโ
         โ
         โผ
โโโโโโโโโโโโโโโโโโโโ
โ  MEMG Environmentโ  โ MDP formulation
โ   (Gym-style)    โ  โ Physical constraints
โโโโโโโโโโฌโโโโโโโโโโ
         โ
         โผ
โโโโโโโโโโโโโโโโโโโโ
โ  PPO Agent       โ  โ Actor-Critic networks
โ  (Risk-Aware)    โ  โ CVaR objective
โโโโโโโโโโฌโโโโโโโโโโ
         โ
         โผ
โโโโโโโโโโโโโโโโโโโโ
โ   Evaluation     โ  โ Metrics & Visualization
โ   & Comparison   โ  โ Baseline comparison
โโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ฆ ูุตุจ ู ุฑุงูโุงูุฏุงุฒ

### ูพุดโูุงุฒูุง
```bash
Python 3.8+
PyTorch 2.0+
NumPy, Pandas, Matplotlib, Seaborn
PyWavelets, SciPy
```

### ูุตุจ
```bash
# Clone repository
git clone https://github.com/emir1111rezaa-ai/MEMG-Risk-Aware-DRL.git
cd MEMG-Risk-Aware-DRL

# Install dependencies
pip install -r requirements.txt
```

---

## ๐ ุงุฌุฑุง

### 1. ุชููุฏ ุฏุงุฏู ู ุขููุฒุด ูพุดโุจูโฺฉููุฏูโูุง
```bash
python train.py
```

ุงู ุงุณฺฉุฑูพุช:
- ุฏุงุฏูโูุง ุณุฑ ุฒูุงู ูุงูุนโฺฏุฑุงุงูู ุชููุฏ ูโฺฉูุฏ (365 ุฑูุฒ)
- ูุฏูโูุง ูพุดโุจู CNN-LSTM ุจุฑุง 4 ูุชุบุฑ ุขููุฒุด ูโุฏูุฏ
- ุนุงูู PPO ุขฺฏุงู ุจู ุฑุณฺฉ ุฑุง ุขููุฒุด ูโุฏูุฏ (300 ุงูพุฒูุฏ)
- ุนุงูู DRL ุณุงุฏู ุฑุง ุจุฑุง ููุงุณู ุขููุฒุด ูโุฏูุฏ

**ุฒูุงู ุงุฌุฑุง**: ~2-3 ุณุงุนุช (ุจุง GPU) / ~6-8 ุณุงุนุช (ุจุง CPU)

### 2. ุงุฑุฒุงุจ ู ููุงุณู
```bash
python evaluate.py
```

ุงู ุงุณฺฉุฑูพุช:
- ุฏูุช ูพุดโุจู ุฑุง ุงุฑุฒุงุจ ูโฺฉูุฏ (MAE, RMSE, MAPE)
- 3 ุฑูุด ุฑุง ุฑู ุฏุงุฏู ุชุณุช ููุงุณู ูโฺฉูุฏ
- ุฌุฏุงูู ููุงุณู ู ูููุฏุงุฑูุง ุชุญูู ุชููุฏ ูโฺฉูุฏ
- ุจูุจูุฏูุง ุฏุฑุตุฏ ุฑุง ูุญุงุณุจู ูโฺฉูุฏ

**ุฒูุงู ุงุฌุฑุง**: ~30-60 ุฏููู

---

## ๐ ุณุงุฎุชุงุฑ ูพุฑูฺู

```
MEMG-Risk-Aware-DRL/
โ
โโโ config.py                    # Configuration parameters
โโโ data_generator.py            # Synthetic data generation
โโโ forecasting_model.py         # CNN-LSTM forecasting module
โโโ memg_environment.py          # MEMG MDP environment
โโโ ppo_agent.py                 # Risk-aware PPO agent
โโโ baseline_methods.py          # Baseline implementations
โโโ train.py                     # Training pipeline
โโโ evaluate.py                  # Evaluation & comparison
โโโ requirements.txt             # Python dependencies
โโโ README.md                    # This file
```

---

## ๐ง ุชูุธูุงุช

ุชูุงู ูพุงุฑุงูุชุฑูุง ุฏุฑ `config.py` ูุงุจู ุชูุธู ูุณุชูุฏ:

### ูพุงุฑุงูุชุฑูุง ุฑุฒุดุจฺฉู
```python
ELECTRICAL_BUS = {
    'pv_capacity': 200.0,        # kW
    'wt_capacity': 150.0,        # kW
    'battery_capacity': 500.0,   # kWh
    'battery_max_power': 100.0,  # kW
    ...
}

CHP_CONFIG = {
    'max_power_elec': 100.0,     # kW
    'electrical_efficiency': 0.35,
    'thermal_efficiency': 0.45,
    ...
}
```

### ูพุงุฑุงูุชุฑูุง ูพุดโุจู
```python
FORECASTING_CONFIG = {
    'cnn_filters': [64, 128, 64],
    'lstm_hidden_size': 128,
    'lookback_window': 168,      # 7 days
    'forecast_horizon': 24,      # 24 hours
    ...
}
```

### ูพุงุฑุงูุชุฑูุง PPO
```python
PPO_CONFIG = {
    'actor_hidden_dims': [256, 256, 128],
    'learning_rate_actor': 3e-4,
    'gamma': 0.99,
    'clip_epsilon': 0.2,
    ...
}
```

### ูพุงุฑุงูุชุฑูุง ุฑุณฺฉ
```python
RISK_CONFIG = {
    'cvar_alpha': 0.95,          # CVaR confidence level
    'risk_aversion': 0.3,        # Risk weight
    ...
}
```

---

## ๐ ูุชุฑฺฉโูุง ุงุฑุฒุงุจ

### ูพุดโุจู
- **MAE** (Mean Absolute Error)
- **RMSE** (Root Mean Squared Error)
- **MAPE** (Mean Absolute Percentage Error)
- **Coverage** (ูพูุดุด ููุงุตู ุงุทููุงู 95%)

### ุจูุฑูโุจุฑุฏุงุฑ
- **ูุฒูู ฺฉู**: ูุฒูู ุฎุฑุฏ ุดุจฺฉู + ุณูุฎุช CHP/ุจููุฑ + ุงุณุชููุงฺฉ ุจุงุชุฑ
- **CVaR ูุฒูู**: ุฑุณฺฉ ุฏู ุชูุฒุน (worst 5%)
- **ููุถ ููุฏ**: ุชุนุฏุงุฏ ู ุดุฏุช ููุถ ูุญุฏูุฏุชโูุง SOCุ ุชูุงูุ ุฑููพ
- **ฺุฑุฎูโูุง ุจุงุชุฑ**: ูุฌููุน ุดุงุฑฺ/ุฏุดุงุฑฺ (ุนูุฑ ุจุงุชุฑ)
- **ุจูุฑูโุจุฑุฏุงุฑ ุงุฒ ุชุฌุฏุฏูพุฐุฑูุง**: ูุณุจุช ุงุณุชูุงุฏู ุงุฒ PV/WT

---

## ๐ ูููุฏุงุฑูุง ุฎุฑูุฌ

1. **cost_comparison.png**: ููุงุณู ูุฒูู ูุชูุณุท
2. **cvar_comparison.png**: ููุงุณู ุฑุณฺฉ CVaR
3. **violations_comparison.png**: ููุงุณู ููุถ ููุฏ
4. **battery_operation.png**: ุนููฺฉุฑุฏ ุจุงุชุฑ ุฏุฑ 3 ุฑูุด
5. **timeseries_detailed.png**: ุณุฑ ุฒูุงู ุฏูู (1 ููุชู)
6. **training_curves_ppo.png**: ููุญูโูุง ุขููุฒุด PPO

---

## ๐ฌ ุฌุฒุฆุงุช ุนูู

### ูุฑูููโุจูุฏ MDP

**State Space** (s_t):
- SOC ุจุงุชุฑ
- ูพุดโุจู ุชููุฏ PV/WT
- ูพุดโุจู ุจุงุฑ ุงูฺฉุชุฑฺฉ/ุญุฑุงุฑุช
- ููุช ุดุจฺฉู
- ุณุงุนุช ุฑูุฒ / ุฑูุฒ ููุชู
- ุชูุงู CHP ูุจู
- ุนุฏู ูุทุนุช ูพุดโุจู

**Action Space** (a_t):
- ุชูุงู ุจุงุชุฑ: P_bat โ [-P_bat_max, P_bat_max]
- ุชูุงู ุงูฺฉุชุฑฺฉ CHP: P_chp โ [P_chp_min, P_chp_max]
- ุชูุงู ุดุจฺฉู: P_grid โ [-P_export_max, P_import_max]
- ุชูุงู ุจููุฑ: P_boiler โ [0, P_boiler_max]

**Reward Function**:
```
R_t = -(Cost_t + ฮป_risk ร CVaR_t + ฮป_viol ร Violations_t + ฮป_smooth ร Smoothness_t)
```

### CVaR Objective

Condition Value at Risk ุจุง ุณุทุญ ุงุทููุงู ฮฑ:

```
CVaR_ฮฑ(C) = E[C | C โฅ VaR_ฮฑ(C)]
```

ฺฉู C ูุฒูู ู VaR_ฮฑ ฺฉูุงูุชุงู (1-ฮฑ) ุชูุฒุน ูุฒูู ุงุณุช.

### ููุฏ ุณุณุชู

1. **ุชุนุงุฏู ุชูุงู ุงูฺฉุชุฑฺฉ**:
```
P_pv + P_wt + P_chp + P_bat + P_grid = P_load_elec
```

2. **ุชุนุงุฏู ุชูุงู ุญุฑุงุฑุช**:
```
P_chp_thermal + P_boiler โฅ P_load_thermal
```

3. **ุฏูุงูฺฉ SOC ุจุงุชุฑ**:
```
SOC_{t+1} = SOC_t + (P_bat ร ฮท_bat ร ฮt) / E_bat_capacity
```

4. **ูุญุฏูุฏุช ุฑููพ CHP**:
```
|P_chp,t - P_chp,t-1| โค R_chp
```

---

## ๐ ุงูุชุดุงุฑุงุช ูุฑุชุจุท

ุงู ูพุฑูฺู ุจุฑ ุงุณุงุณ ุชุญููุงุช ุฒุฑ ุทุฑุงุญ ุดุฏู ุงุณุช:

1. **Deep Reinforcement Learning for Energy Management**
   - Cao et al., "Deep Reinforcement Learning-Based Energy Storage Arbitrage", IEEE Trans. Smart Grid, 2021

2. **Risk-Aware Control**
   - Chow et al., "Risk-Constrained Reinforcement Learning with Percentile Risk Criteria", JMLR, 2018

3. **Multi-Energy Systems**
   - Mancarella, "MES (Multi-Energy Systems): An Overview", Energy, 2014

4. **Advanced Forecasting**
   - Wang et al., "A Review of Deep Learning for Renewable Energy Forecasting", Energy Conv. Mgmt., 2019

---

## ๐ค ูุดุงุฑฺฉุช

ุจุฑุง ูุดุงุฑฺฉุช:
1. Fork ฺฉูุฏ
2. ุจุฑูฺ feature ุจุณุงุฒุฏ (`git checkout -b feature/AmazingFeature`)
3. ุชุบุฑุงุช ุฑุง commit ฺฉูุฏ (`git commit -m 'Add AmazingFeature'`)
4. Push ฺฉูุฏ (`git push origin feature/AmazingFeature`)
5. Pull Request ุจุงุฒ ฺฉูุฏ

---

## ๐ ูุงุณูุณ

MIT License - ุจุฑุง ุฌุฒุฆุงุช ุจู LICENSE ูุฑุงุฌุนู ฺฉูุฏ.

---

## ๐ง ุชูุงุณ

ุจุฑุง ุณูุงูุงุช ุง ููฺฉุงุฑโูุง ุชุญููุงุช:
- GitHub: [@emir1111rezaa-ai](https://github.com/emir1111rezaa-ai)
- Repository: [MEMG-Risk-Aware-DRL](https://github.com/emir1111rezaa-ai/MEMG-Risk-Aware-DRL)

---

## ๐ ุชุดฺฉุฑ

ุงุฒ ุฌุงูุนู ูุชูโุจุงุฒ PyTorchุ OpenAI Gym ู ุณุงุฑ ฺฉุชุงุจุฎุงููโูุง ุงุณุชูุงุฏู ุดุฏู ุชุดฺฉุฑ ูโฺฉูู.

---

**ูฺฉุชู**: ุงู ฺฉ ูพุฑูฺู ุชุญููุงุช ุงุณุช. ุจุฑุง ุงุณุชูุงุฏู ุฏุฑ ุณุณุชูโูุง ูุงูุนุ ุชุณุช ู ุงุนุชุจุงุฑุณูุฌ ุฏููโุชุฑ ูุงุฒ ุงุณุช.
